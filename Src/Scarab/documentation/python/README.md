# Scarab/documentation

This directory contains the files necessary to setup automated documentation for a python project.

The documentation system will create a documentation website hosted and automatically generated by readthedocs.org (RTD).
You will be able to access the documentation at these URLs:
* www.project8.org/[github repo name]
* [RTD project name].readthedocs.io
* [RTD project name].rtfd.io

The software stack used to generate the documentation is:
* Sphinx -- Python-based documentation website generation
* Breathe -- Sphinx extension for Doxygen (confirm that we actually use this?)
* better_apidoc -- tool for automatically walking through python packages and generating rst files for the API (confirm that we need this one)
* readthedocs.org -- Website generation and hosting


## Instructions for setting up documentation for a python project.

### In your project repo
1. Create a documentation directory.
1. Copy into it the file `conf.py` and `index.rst` and the entire directory `_templates`.
1. If you have rst documentation files, put them in the documentation directory; otherwise it's recommended to create a placeholder rst file for use or descriptive documentation.
1. Put the filename(s) for any rst documentation files (minus .rst extension) in `index.rst` after the initial lines defining the table of contents (above the line `better_apidoc_out/modules`).
1. Customize `index.rst` and `conf.py` with the name and description of your project.
1. Customize (if needed) the logic used to assign the `version` and `release` variables in `conf.py`. (Default is to derive values from git tags)
1. If you have a favicon file, put it in the documentation directory and specify it in `conf.py`; otherwise comment out the `html_favicon` variable in that file.
1. Recommendation: don't merge these changes into the master branch just yet; test the creation of the documentation (described below) first.
1. The package `better-apidoc` is required for building the documentation, but if you add it as an optional dependency RTD won't install it. You have two options:
    1. Create a `docs_build_requirements.txt` file (named as you please) which lists that package *and* configure RTD (under admin) to install dependencies from that file.
    1. Add the following lines of logic to your setup.py file
    ```
        on_rtd  os.environ.get("READTHEDOCS", None) == 'True'
        requirements = list()
        if not on_rtd:
            # requirements.append(<'the_name_of_first_required_dependency'>)
            ...
        else:
            requirements.append('better-apidoc')

        ...
        setup( # this line will already exist, but it is shown to indicate where the next line goes
            install_requires=requirements
            ...
        )
    ```
1. RTD is going to try and install your project and the automatic documentation of API docs expects to be able to import the package and inspect the contents. You need to ensure that the above works, which means either installing your dependencies or making them optional (at least for importing the package, obviously they can be required at runtime). In practice, you should see if your docs build and deploy and if not debug based on the output available on readthedocs.org site.

### On readthedocs
1. Create an RTD project for your software project by importing from GitHub (this will automatically create a webhook directed to RTD).
1. As you change each settings in each category below, be sure to press the Submit button so the changes are saved.
1. Under Admin:Advanced Settings:
    1. Check the box to "Install your project inside a virtualenv using setup.py install"
    1. If using one, specify the location of the requirements.txt file under "Requirements file".
    1. Specify the location of conf.py under "Python configuration file".
    1. Specify the branch where your documentation currently resides as "Default branch".
    1. Deselct "Enable PDF build" and "Enable EPUB build" (we don't currently use these, if someone shows that are builds work we can turn them on, if there's a reason to do so).
    1. Determine if you want to enable "use system packages" (this may depend on the install set for your package).
1. Under Admin:Maintainers, add Noah as an additional maintainer so we can maintain access if you're unavailable.
1. Under Builds you should see the `latest` build building.  Once it's done, check the documentation to make sure it worked.  If it worked great, carry on. If not, go back and fix whatever's wrong.
1. Under Admin:Advanced Settings, switch the "Default branch" to `master`.

### In your project repo
1. Merge your changes to the master branch with a new release; this should trigger a new build of the documentation, which you should then go and check.
1. If it doesn't already exist, create an orphan branch in your repo called `gh-pages` and clear it of all files.
1. Populate the `gh-pages` branch with an empty file called `.nojekyll` and the following in `index.html`:
    ```
    <html>
        <head>
            <meta http-equiv="refresh" content="0; url=https://scarab.readthedocs.io/">
        </head>
    </html>
    ```
    with your RTD project name replacing `scarab`.
1. Commit and push `gh-pages` to GitHub.
1. In the settings for your repo, under GitHub Pages, make sure that the Source drop-down menu has `gh-pages` selected.
1. Check that if you go to `http://www.project8.org/[github repo name]` it redirects to the RTD documentation.
